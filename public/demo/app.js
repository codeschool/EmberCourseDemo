var App = Ember.Application.create({
  LOG_TRANSITIONS: true
});

App.Router.map(function() {
  this.route('credits');
  this.resource('contacts', function() {
    this.resource('contact', { path: '/:contact_id' });
  });

  this.resource('products', function() {
    this.route('seasonal');
    this.route('sale');
    this.resource('product', { path: '/:product_id' });
  });
});

if (window.history && window.history.pushState) {
  App.Router.reopen({
    location: 'hash',
    rootURL: '/demo/index.html'
  });
}


// Index
App.IndexRoute = Ember.Route.extend({
  model: function() {
    return this.store.findAll('product');
  }
});
App.IndexController = Ember.ArrayController.extend({
  onSale: function() {
    //return this.filterProperty('isOnSale', true).slice(0,3);
    return this.filterBy('isOnSale').slice(0,3);
  }.property('@each.isOnSale'),

  // productCount: function() {
  //   return this.get('length');
  // }.property('length')

  productCount: Ember.computed.alias('length')
});





// Products
App.ProductsRoute = Ember.Route.extend({
  model: function() {
    return this.store.findAll('product');
  }
});
App.ProductsIndexRoute = Ember.Route.extend({
  model: function () {
    return this.modelFor('products');
  }
});
App.ProductsSeasonalRoute = Ember.Route.extend({
  model: function () {
    return this.modelFor('products').filterProperty('isSeasonal', true);
  }
});
App.ProductsSaleRoute = Ember.Route.extend({
  model: function () {
    return this.modelFor('products').filterBy('isOnSale');
  }
});
App.ProductsController = Ember.ArrayController.extend({
  sortProperties: ['title'],
  count: function() {
    return this.get('length');
  }.property('length'),

  // Slides
  onSale: function() {
    return this.filterBy('isOnSale').get('length');
  }.property('@each.isOnSale'),

  // Challenges
  seasonal: function () {
    return this.filterBy('isSeasonal').get('length');
  }.property('@each.isSeasonal'),
});

App.ProductReviewsNewController = Ember.ObjectController.extend({
  reviewText: '',
  actions: {
    createReview: function() {
      var product = this.get('model'),
          review = this.store.createRecord('review', {review: this.get('reviewText')})
      product.get('reviews').addObject(review);
    }
  }
});






// Contacts
App.ContactsRoute = Ember.Route.extend({
  model: function() {
    return this.store.findAll('contact');
  }
});
App.ContactsController = Ember.ArrayController.extend({
  sortProperties: ['name']
});

App.ContactsIndexController = Ember.Controller.extend({
  open: function() {
    debugger
    return "Open Now";
  }.property()
});



// Handlebars
Ember.Handlebars.registerBoundHelper('money', function(value) {
  return accounting.formatMoney(value/100);
});



// Components
// App.ProductDetailComponent = Ember.Component.extend({
//   classNameBindings: ['isOnSale:adsfasdfa']
// });

App.ProductDetailComponent = Ember.Component.extend({
  classNameBindings: ['isOnSale'],
  isOnSale: function() {
    return this.get('product.isOnSale');
  }.property()
});


// Data
App.ApplicationAdapter = DS.FixtureAdapter.extend();
//App.ApplicationAdapter = DS.RESTAdapter.extend();
var attr = DS.attr;
App.Product = DS.Model.extend({
  title: DS.attr(),
  price: DS.attr(),
  description: DS.attr(),
  image: DS.attr(),
  imageCredit: DS.attr(),
  isOnSale: DS.attr('boolean'),
  isSeasonal: DS.attr('boolean'),
  reviews: DS.hasMany('review', {async: true})
});

App.Product.FIXTURES = [
  {
    id: 1,
    title: 'Flint',
    price: 99,
    description: 'Flint is a hard, sedimentary cryptocrystalline form of the mineral quartz, categorized as a variety of chert.',
    isOnSale: true,
    isSeasonal: true,
    ratings: [100, 101],
    image: 'images/products/flint.png',
    imageCredit: ''
  },
  {
    id: 2,
    title: 'Kindling',
    price: 249,
    description: 'Easily combustible small sticks or twigs used for starting a fire.',
    isOnSale: false,
    isSeasonal: true,
    ratings: [102, 103],
    image: 'images/products/kindling.png',
    imageCredit: ''
  },
  {
    id: 3,
    title: 'Matches',
    price: 499,
    description: 'One end is coated with a material that can be ignited by frictional heat generated by striking the match against a suitable surface.',
    isOnSale: true,
    isSeasonal: true,
    ratings: [104],
    image: 'images/products/matches.png',
    imageCredit: ''
  },
  {
    id: 4,
    title: 'Bow Drill',
    price: 999,
    description: 'The bow drill is an ancient tool. While it was usually used to make fire, it was also used for primitive woodworking and dentistry.',
    isOnSale: false,
    isSeasonal: false,
    ratings: [],
    image: 'images/products/bow-drill.png',
    imageCredit: ''
  },
  {
    id: 5,
    title: 'Tinder',
    price: 499,
    description: 'Tinder is easily combustible material used to ignite fires by rudimentary methods.',
    isOnSale: true,
    isSeasonal: false,
    ratings: [],
    image: 'images/products/tinder.png',
    imageCredit: ''
  },
  {
    id: 6,
    title: 'Birch Bark Shaving',
    price: 999,
    description: 'Fresh and easily combustable',
    isOnSale: true,
    isSeasonal: false,
    ratings: [],
    image: 'images/products/birch.png',
    imageCredit: ''
  }
]

App.Review = DS.Model.extend({
  review: DS.attr('string'),
  reviewedAt: DS.attr('date'),
  product: DS.belongsTo('product')
});

App.Review.FIXTURES = [
  { id: 100, product: 1, review: "Very good!" },
  { id: 101, product: 1, review: "Amazing!" },
  { id: 102, product: 2, review: "Also Amazing!" },
  { id: 103, product: 2, review: "Worth checking out." },
  { id: 104, product: 3, review: "Not worth it." },
]

App.Contact = DS.Model.extend({
  name: DS.attr(),
  avatar: DS.attr(),
  joined: DS.attr('number'),
  description: DS.attr()
});

App.Contact.FIXTURES = [
  {
    id: 200,
    name: 'Flame Spirit 1',
    joined: 2010,
    avatar: 'images/contacts/patty.png',
    description: 'Description here'
  },
  {
    id: 201,
    name: 'Flame Spirit 2',
    joined: 2010,
    avatar: 'images/contacts/adam.png',
    description: 'description here'
  },
  {
    id: 202,
    name: 'Flame Spirit 3',
    joined: 2012,
    avatar: 'images/contacts/martin.png',
    description: 'description here'
  }
];
