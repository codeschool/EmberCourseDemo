
<script type="text/x-handlebars">
  <div class="navbar navbar-default">
    <div class="container">
      {{#link-to "index" class="navbar-brand"}}<img src="/assets/logo.png" alt="logo" height="34" width="224">{{/link-to}}
      <ul class="nav navbar-nav navbar-right">
        {{#link-to 'index' tagName='li'}}Home{{/link-to}}
        {{#link-to 'about' tagName='li'}}About{{/link-to}}
        {{#link-to 'products' tagName='li'}}Products{{/link-to}}
      </ul>
    </div>
  </div>

  <div class="container">
    {{outlet}}
  </div>

  <footer class='container'>
    <hr />
    <p class='pull-left'>&copy; 2013 The Flint &amp; Flame</p>
    <p class='pull-right'><a href='#/credits'>Credits</a></p>
  </footer>
</script>

<script type='text/x-handlebars' data-template-name='index'>
  <h1>Welcome to The Flint & Flame!</h1>
  <p>There are {{productsCount}} products</p>
  <img {{bind-attr src='logo'}} alt='Logo' />
  <p>Rendered on {{time}}</p> 
</script>

<script type='text/x-handlebars' data-template-name='about'>
  <h1>About The Fire Spirits</h1>
</script>

<!--
{{#each product in controller}}
{{#each product in controller.model}}
{{#each product in model}}
-->
<script type="text/x-handlebars" data-template-name='products'>
<div class='row'>
  <div class='col-sm-3'>
    <div class="list-group">
      {{#each}}
        {{#link-to 'product' this classNames="list-group-item"}}
          {{title}}
        {{/link-to}}
      {{/each}}
    </div>
  </div>
  <div class='col-sm-9'>
    {{outlet}}
  </div>
</div>
</script>

<script type="text/x-handlebars" data-template-name='product'>
  <div class='row'>
    <div class='col-sm-7'>
      <h2>{{title}}</h2>
      <h3 class="text-success">${{price}}</h3>
      <p class="text-muted">{{description}}</p>

      <h3>Reviews</h3>
      <ul>
      {{#each reviews}}
        <li><p>{{text}}</p></li>
      {{else}}
        <li><p class='text-muted'><em>No reviews yet. Be the first to write one!</em></p></li>
      {{/each}}
      </ul>

    </div>
    <div class='col-sm-5'>
      <img {{bind-attr src='image'}} class='img-thumbnail img-rounded'/>
    </div>
  </div>
</script>

<script type='text/x-handlebars' data-template-name='products/index'>
  <p class="text-muted">Choose a product from those on the left!</p>
</script>

<script type='text/javascript'>
  App = Ember.Application.create();
  App.Router.map(function() {
    this.route('about');
    this.resource('products', function() {
      this.resource('product', { path: '/:product_id' });
    });
  });

  App.IndexController = Ember.Controller.extend({
    logo: "/assets/logo.png",
    productCount: 6,
    time: function() {
      return (new Date()).toDateString();
    }.property()
  });

  App.ProductsRoute = Ember.Route.extend({
    model: function() {
      return this.store.find('product');
    }
  });

  App.ProductsController = Ember.ArrayController.extend({
    sortProperties: ['title']
  });

  App.ApplicationAdapter = DS.FixtureAdapter.extend();
  var attr = DS.attr;
  App.Product = DS.Model.extend({
    title: DS.attr(),
    price: DS.attr(),
    description: DS.attr(),
    isOnSale: DS.attr(),
    image: DS.attr(),
    reviews: DS.hasMany('review', {async: true}),
  });

  App.Review = DS.Model.extend({
    text: DS.attr('string'),
    reviewedAt: DS.attr('date'),
    product: DS.belongsTo('product')
  });

  App.Product.FIXTURES = [
    {
      id: 1,
      title: 'Flint',
      price: 99,
      description: 'Flint is a hard, sedimentary cryptocrystalline form of the mineral quartz, categorized as a variety of chert.',
      isSeasonal: true,
      image: '/assets/products/flint.png',
      reviews: [100,101]
    },
    {
      id: 2,
      title: 'Kindling',
      price: 249,
      description: 'Easily combustible small sticks or twigs used for starting a fire.',
      isOnSale: false,
      image: '/assets/products/kindling.png',
      reviews: [102]
    },
    {
      id: 3,
      title: 'Matches',
      price: 499,
      description: 'One end is coated with a material that can be ignited by frictional heat generated by striking the match against a suitable surface.',
      isOnSale: true,
      reviews: [103],
      image: '/assets/products/matches.png'
    },
    {
      id: 4,
      title: 'Bow Drill',
      price: 999,
      description: 'The bow drill is an ancient tool. While it was usually used to make fire, it was also used for primitive woodworking and dentistry.',
      isOnSale: false,
      reviews: [104],
      image: '/assets/products/bow-drill.png'
    },
    {
      id: 5,
      title: 'Tinder',
      price: 499,
      description: 'Tinder is easily combustible material used to ignite fires by rudimentary methods.',
      isOnSale: true,
      reviews: [],
      image: '/assets/products/tinder.png'
    },
    {
      id: 6,
      title: 'Birch Bark Shaving',
      price: 999,
      description: 'Fresh and easily combustable',
      isOnSale: true,
      reviews: [],
      image: '/assets/products/birch.png'
    }
  ];

  App.Review.FIXTURES = [
    { id: 100, product: 1, text: "Started a fire in no time!" },
    { id: 101, product: 1, text: "Not the brightest flame, but warm!" },
    { id: 102, product: 2, review: "A generious amount -- enough to make at least 3 fires!" },
    { id: 103, product: 3, review: "If you have a dry place to keep these, they're a lifesaver." },
    { id: 104, product: 4, review: "I don't even have arms, how would I operate this?" }
  ]
</script>